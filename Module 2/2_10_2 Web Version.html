<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mini Voting App (Web Version)</title>
    <style>
        /* Minimal styles to make the demo readable */
        body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 20px; }
        .hidden { display: none; }
        .container { max-width: 720px; margin: 0 auto; }
        fieldset { margin-bottom: 1rem; }
        ul { padding-left: 1.2rem; }
        .candidate { display:flex; justify-content:space-between; padding:4px 0; }
        button { margin-left: 8px; }
        /* Feedback styling: a small green pill that fades out */
        #feedback {
            display: inline-block;
            margin-left: 12px;
            padding: 6px 10px;
            background: #e6ffed; /* very light green */
            color: #0b8043; /* darker green text */
            border-radius: 16px;
            font-size: 0.95rem;
            transition: opacity 500ms ease-in-out, transform 500ms ease-in-out;
            opacity: 1;
            transform: translateY(0);
        }
        #feedback.hidden { opacity: 0; transform: translateY(-6px); }
    </style>
</head>
<body>
    <main class="container">
        <h1>Mini Voting App</h1>

        <!--
            This page implements the same functionality as the 2_10.html, but in a small interactive web UI. 
            The flow is:
              1) Enter number of candidates (or add candidates directly)
              2) Enter candidate names
              3) Enter number of voters
              4) For each voter, choose a candidate and submit the vote
              5) When voting is finished show results and the winner
        -->

        <!-- Step 1: UI for entering the number of candidates -->
        <section id="setup">
            <fieldset>
                <legend>Step 1 — Candidates</legend>
                <p>
                    You can enter how many candidates there will be and click
                    "Create fields", or you can add candidates manually using
                    the "Add candidate" button.
                </p>

                <label>
                    Number of candidates:
                    <input id="numCandidates" type="number" min="1" value="2" />
                </label>
                <button id="createFields">Create fields</button>
                <button id="addCandidate">Add candidate</button>

                <!-- Container where candidate name inputs will be created -->
                <div id="candidatesInputs"></div>
            </fieldset>

            <fieldset>
                <legend>Step 2 — Voters</legend>
                <label>
                    Number of voters:
                    <input id="numVoters" type="number" min="0" value="3" />
                </label>
                <p>When ready, click <strong>Start Voting</strong>.</p>
                <button id="startVoting">Start Voting</button>
            </fieldset>
        </section>

        <!-- Step 3: Voting UI (updated dynamically) -->
        <section id="voting" class="hidden">
            <fieldset>
                <legend>Voting</legend>
                <p id="voterInfo">Voter 1 of N</p>

                <label>
                    Choose candidate:
                    <select id="voteSelect"></select>
                </label>
                <button id="submitVote">Submit Vote</button>

                <!-- Visual feedback area shown briefly after a vote is recorded -->
                <div id="feedback" class="hidden" aria-live="polite"></div>

                <p><button id="finishEarly">Finish early</button></p>
            </fieldset>
        </section>

        <!-- Results section -->
        <section id="results" class="hidden">
            <fieldset>
                <legend>Results</legend>
                <h2 id="winnerHeading">Winner: —</h2>
                <h3>All results</h3>
                <ul id="resultsList"></ul>
                <p><button id="reset">Reset</button></p>
            </fieldset>
        </section>
    </main>

    <script>
        /*
            Data model:
            - candidates: Array of objects { name: string, votes: number }
            - numVoters: total number of voters expected (integer >= 0)
            - currentVoter: counter of how many votes have been submitted

            We preserve the original behavior: voters may choose not to vote
            (we allow an explicit "No vote" option). After all votes or when
            the user finishes early, the results are displayed and the winner
            (candidate with most votes) is announced.
        */

        // DOM references for ease of use
        const numCandidatesInput = document.getElementById('numCandidates');
        const createFieldsBtn = document.getElementById('createFields');
        const addCandidateBtn = document.getElementById('addCandidate');
        const candidatesInputsDiv = document.getElementById('candidatesInputs');
        const numVotersInput = document.getElementById('numVoters');
        const startVotingBtn = document.getElementById('startVoting');

        const votingSection = document.getElementById('voting');
        const voterInfo = document.getElementById('voterInfo');
        const voteSelect = document.getElementById('voteSelect');
        const submitVoteBtn = document.getElementById('submitVote');
        const finishEarlyBtn = document.getElementById('finishEarly');
    const feedbackDiv = document.getElementById('feedback');

        const resultsSection = document.getElementById('results');
        const winnerHeading = document.getElementById('winnerHeading');
        const resultsList = document.getElementById('resultsList');
        const resetBtn = document.getElementById('reset');

        // Application state
        let candidates = []; // [{name, votes}, ...]
        let numVoters = 0;
        let currentVoter = 0;

        // Helper: create N text inputs to collect candidate names
        function createCandidateFields(n) {
            candidatesInputsDiv.innerHTML = '';
            for (let i = 0; i < n; i++) {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <label>
                        Candidate ${i + 1}: <input class="candidateName" type="text" value="" />
                    </label>
                `;
                candidatesInputsDiv.appendChild(wrapper);
            }
        }

        // Add a single candidate input field (used when user clicks Add candidate)
        function addCandidateField(value = '') {
            const wrapper = document.createElement('div');
            wrapper.innerHTML = `
                <label>
                    Candidate: <input class="candidateName" type="text" value="${value}" />
                </label>
            `;
            candidatesInputsDiv.appendChild(wrapper);
        }

        // Read candidate inputs and initialise the candidates array
        function readCandidatesFromInputs() {
            const inputs = Array.from(document.querySelectorAll('.candidateName'));
            // Filter out empty names to avoid blank candidates
            const names = inputs.map(i => i.value.trim()).filter(n => n.length > 0);

            // Map to data objects used by the app
            candidates = names.map(name => ({ name: name, votes: 0 }));
        }

        // Populate the voting <select> with current candidates and a "No vote" option
        function refreshVoteSelect() {
            voteSelect.innerHTML = '';
            const noVoteOption = document.createElement('option');
            noVoteOption.value = '__no_vote__';
            noVoteOption.textContent = '-- No vote --';
            voteSelect.appendChild(noVoteOption);

            candidates.forEach((c, idx) => {
                const opt = document.createElement('option');
                opt.value = String(idx); // use index to identify candidate
                opt.textContent = `${c.name}`;
                voteSelect.appendChild(opt);
            });
        }

        // Compute and render results, sort by votes desc and announce winner
        function showResults() {
            // create a shallow copy and sort by votes descending
            const sorted = candidates.slice().sort((a, b) => b.votes - a.votes);

            resultsList.innerHTML = '';
            sorted.forEach(c => {
                const li = document.createElement('li');
                li.textContent = `${c.name}: ${c.votes} vote${c.votes !== 1 ? 's' : ''}`;
                resultsList.appendChild(li);
            });

            // Winner is the first in the sorted list. Note: if there is a tie,
            // this picks the first candidate with the highest vote count.
            if (sorted.length > 0) {
                const winner = sorted[0];
                winnerHeading.textContent = `Winner: ${winner.name} (${winner.votes} vote${winner.votes !== 1 ? 's' : ''})`;
            } else {
                winnerHeading.textContent = 'Winner: — (no candidates)';
            }

            // Show results section
            resultsSection.classList.remove('hidden');
            votingSection.classList.add('hidden');
        }

        // Reset app to initial state
        function resetApp() {
            candidates = [];
            numVoters = 0;
            currentVoter = 0;
            candidatesInputsDiv.innerHTML = '';
            voteSelect.innerHTML = '';
            resultsList.innerHTML = '';
            winnerHeading.textContent = 'Winner: —';

            // show setup again
            document.getElementById('setup').classList.remove('hidden');
            votingSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
        }

        // Event handlers wiring
        createFieldsBtn.addEventListener('click', () => {
            const n = parseInt(numCandidatesInput.value, 10) || 0;
            if (n > 0 && n <= 100) { // limit to reasonable number
                createCandidateFields(n);
            } else {
                alert('Please enter a valid number of candidates (1-100).');
            }
        });

        addCandidateBtn.addEventListener('click', () => addCandidateField());

        startVotingBtn.addEventListener('click', () => {
            // read candidates and initialize state
            readCandidatesFromInputs();
            if (candidates.length === 0) {
                alert('Please provide at least one candidate before starting voting.');
                return;
            }

            numVoters = parseInt(numVotersInput.value, 10) || 0;
            if (numVoters < 0) numVoters = 0;

            // hide setup and show voting UI
            document.getElementById('setup').classList.add('hidden');
            votingSection.classList.remove('hidden');

            // prepare the select and reset voter counter
            currentVoter = 0;
            refreshVoteSelect();
            updateVoterInfo();
        });

        function updateVoterInfo() {
            voterInfo.textContent = `Voter ${Math.min(currentVoter + 1, numVoters)} of ${numVoters}`;
        }

        submitVoteBtn.addEventListener('click', () => {
            // Handle vote submission for currentVoter
            const val = voteSelect.value;
            if (val !== '__no_vote__') {
                const idx = parseInt(val, 10);
                if (!Number.isNaN(idx) && candidates[idx]) {
                    candidates[idx].votes += 1;
                }
            }

            // Advance to next voter
            currentVoter += 1;

            if (currentVoter >= numVoters) {
                // Voting finished
                showResults();
            } else {
                // Provide a small visual confirmation for the voter so they
                // clearly see their vote was recorded. We briefly disable the
                // submit button to avoid double submissions.
                feedbackDiv.textContent = 'Vote recorded ✅';
                feedbackDiv.classList.remove('hidden');
                submitVoteBtn.disabled = true;

                // After a short delay, hide the feedback, re-enable the
                // submit button, reset the select to 'No vote' and focus it
                // so the next voter can immediately interact.
                setTimeout(() => {
                    feedbackDiv.classList.add('hidden');
                    submitVoteBtn.disabled = false;
                    voteSelect.value = '__no_vote__';
                    updateVoterInfo();
                    voteSelect.focus();
                }, 700); // 700ms gives a quick but noticeable confirmation
            }
        });

        // Allow finishing early
        finishEarlyBtn.addEventListener('click', () => showResults());

        resetBtn.addEventListener('click', () => resetApp());

        // Initialize page with two candidate fields by default for convenience
        createCandidateFields(2);
    </script>
</body>
</html>